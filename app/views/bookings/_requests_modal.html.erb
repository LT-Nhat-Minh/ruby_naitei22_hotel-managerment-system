<div id="bookingModal-<%= booking.id %>" class="custom-modal hidden">
    <div class="custom-modal-content">
        <span class="close-modal" data-modal-id="bookingModal-<%= booking.id %>">&times;</span>
        <h2>Booking Details</h2>
        <p>Booking ID: <%= booking.booking_code %></p>
        <div class="modal-body">
        <% if booking.requests.any? %>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th data-column="request-id" data-order="asc" data-sortable>Request ID</th>
                <th data-column="room-name" data-order="asc" data-sortable>Room Name</th>
                <th data-column="price" data-order="asc" data-sortable>Price</th>
                <th data-column="check-in" data-order="asc" data-sortable>Check-in</th>
                <th data-column="check-out" data-order="asc" data-sortable>Check-out</th>
                <th>Status</th>
                <th>Feedback</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <% booking.requests.each do |request| %>
                <% 
                  # Lấy tên phòng từ room_availability_requests
                  room_names = request.room_availability_requests
                                      .includes(room_availability: { room: :room_type })
                                      .map { |rar| rar.room_availability.room.room_type.name }
                                      .uniq
                  # Lấy giá từ room_availabilities (nếu nhiều phòng thì cộng lại)
                  total_price = request.room_availability_requests
                                       .includes(:room_availability)
                                       .sum { |rar| rar.room_availability.price }
                %>

                <tr>
                  <td><%= request.id %></td>
                  <td><%= room_names.join(", ") %></td>
                  <td><%= number_to_currency(total_price, unit: "", delimiter: ".", precision: 0) %></td>
                  <td><%= l(request.check_in, format: :long) %></td>
                  <td><%= l(request.check_out, format: :long) %></td>
                  <td><%= render "shared/status_badge", status: request.status %></td>
                  <td>
                    <% if request.status == "pending" || request.status == "draft" %>
                      <%= link_to "Cancel", cancel_request_path(request), method: :patch, class: "btn btn-danger btn-sm" %>
                    <% else %>
                      <button class="btn btn-secondary btn-sm" disabled>Cancel</button>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <p class="text-muted">Không có request nào cho booking này.</p>
        <% end %>
      </div>
    </div>
</div>
